(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{7450:function(e,a,n){Promise.resolve().then(n.bind(n,3768))},3768:function(e,a,n){"use strict";n.r(a),n.d(a,{default:function(){return N}});var t=n(7437),r=n(2265),s=n(257);function i(e){let{product:a,onEdit:n,onDelete:r}=e,i=a.imageUrl.startsWith("http")?a.imageUrl:"".concat(s.env.NEXT_PUBLIC_API_URL||"").concat(a.imageUrl);return(0,t.jsxs)("div",{className:"product-card",children:[(0,t.jsx)("img",{src:i,alt:a.nameJa||a.name,className:"product-image",onError:e=>{e.target.src="/placeholder.jpg"}}),(0,t.jsx)("div",{className:"product-name",children:a.nameJa||a.name}),(0,t.jsxs)("div",{className:"product-price ".concat(a.isNewPrice?"new-price":""),children:[a.isNewPrice&&(0,t.jsx)("span",{className:"new-price-badge",children:"New Price"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"price-value",children:a.price.toLocaleString("ja-JP")}),(0,t.jsxs)("span",{className:"price-unit",children:["円/",a.unit]})]})]}),(0,t.jsxs)("div",{className:"actions",style:{marginTop:"15px"},children:[(0,t.jsx)("button",{className:"btn btn-secondary btn-small",onClick:()=>n(a),children:"編集"}),(0,t.jsx)("button",{className:"btn btn-danger btn-small",onClick:()=>r(a.id),children:"削除"})]})]})}var l=n(3464),c=n(257);let o=c.env.NEXT_PUBLIC_API_URL||"http://localhost:8787",d=c.env.NEXT_PUBLIC_ADMIN_TOKEN||"",u=l.Z.create({baseURL:o,headers:{"Content-Type":"application/json"}});async function p(){return(await u.get("/api/products")).data}async function m(e){return(await u.post("/api/products",e,{headers:{Authorization:"Bearer ".concat(d)}})).data.product}async function h(e,a){return(await u.put("/api/products/".concat(e),a,{headers:{Authorization:"Bearer ".concat(d)}})).data.product}async function x(e){await u.delete("/api/products/".concat(e),{headers:{Authorization:"Bearer ".concat(d)}})}async function j(e){let a=new FormData;return a.append("file",e),(await u.post("/api/upload",a,{headers:{Authorization:"Bearer ".concat(d),"Content-Type":"multipart/form-data"}})).data}function g(e){let{onUploadComplete:a,currentImageUrl:n}=e,[s,i]=(0,r.useState)(null),[l,c]=(0,r.useState)(n||""),[o,d]=(0,r.useState)(!1),[u,p]=(0,r.useState)(null),m=async()=>{if(s)try{d(!0),p(null);let e=await j(s);a(e.url),i(null)}catch(e){p("画像のアップロードに失敗しました"),console.error(e)}finally{d(!1)}};return(0,t.jsxs)("div",{children:[(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let n=null===(a=e.target.files)||void 0===a?void 0:a[0];if(n){i(n),p(null);let e=new FileReader;e.onloadend=()=>{c(e.result)},e.readAsDataURL(n)}},style:{marginBottom:"10px"}}),l&&(0,t.jsx)("img",{src:l,alt:"Preview",className:"image-preview"}),s&&(0,t.jsxs)("div",{children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary btn-small",onClick:m,disabled:o,style:{marginTop:"10px"},children:o?"アップロード中...":"画像をアップロード"}),u&&(0,t.jsx)("div",{className:"error",style:{marginTop:"10px"},children:u})]})]})}function v(e){let{product:a,onClose:n,onSave:s}=e,[i,l]=(0,r.useState)({name:"",nameJa:"",imageUrl:"",price:0,unit:"kg",isNewPrice:!1}),[c,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(null);(0,r.useEffect)(()=>{a&&l({name:a.name||"",nameJa:a.nameJa||"",imageUrl:a.imageUrl||"",price:a.price||0,unit:a.unit||"kg",isNewPrice:a.isNewPrice||!1})},[a]);let p=async e=>{if(e.preventDefault(),!i.nameJa&&!i.name){u("商品名を入力してください");return}if(i.price<0){u("価格は0以上である必要があります");return}try{o(!0),u(null);let e={...i};a?await h(a.id,e):await m(e),s()}catch(e){u("保存に失敗しました"),console.error(e)}finally{o(!1)}};return(0,t.jsx)("div",{className:"modal active",onClick:n,children:(0,t.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,t.jsxs)("div",{className:"modal-header",children:[(0,t.jsx)("h2",{children:a?"商品を編集":"新しい商品を追加"}),(0,t.jsx)("span",{className:"close",onClick:n,children:"\xd7"})]}),d&&(0,t.jsx)("div",{className:"error",children:d}),(0,t.jsxs)("form",{onSubmit:p,children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"商品名（日本語）*"}),(0,t.jsx)("input",{type:"text",value:i.nameJa,onChange:e=>l({...i,nameJa:e.target.value}),required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"商品名（英語）"}),(0,t.jsx)("input",{type:"text",value:i.name,onChange:e=>l({...i,name:e.target.value})})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"画像"}),(0,t.jsx)(g,{onUploadComplete:e=>{l(a=>({...a,imageUrl:e}))},currentImageUrl:i.imageUrl}),i.imageUrl&&(0,t.jsxs)("div",{style:{marginTop:"10px",fontSize:"12px",color:"#666"},children:["現在の画像URL: ",i.imageUrl]})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"価格（円）*"}),(0,t.jsx)("input",{type:"number",value:i.price,onChange:e=>l({...i,price:parseFloat(e.target.value)||0}),min:"0",step:"0.01",required:!0})]}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{children:"単位*"}),(0,t.jsxs)("select",{value:i.unit,onChange:e=>l({...i,unit:e.target.value}),required:!0,children:[(0,t.jsx)("option",{value:"kg",children:"kg"}),(0,t.jsx)("option",{value:"台",children:"台"}),(0,t.jsx)("option",{value:"個",children:"個"})]})]}),(0,t.jsx)("div",{className:"form-group",children:(0,t.jsxs)("label",{children:[(0,t.jsx)("input",{type:"checkbox",checked:i.isNewPrice,onChange:e=>l({...i,isNewPrice:e.target.checked})}),"New Price タグを表示"]})}),(0,t.jsxs)("div",{className:"actions",children:[(0,t.jsx)("button",{type:"button",className:"btn btn-secondary",onClick:n,children:"キャンセル"}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?"保存中...":"保存"})]})]})]})})}function N(){let[e,a]=(0,r.useState)([]),[n,s]=(0,r.useState)(!0),[l,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!1),[u,m]=(0,r.useState)(null);(0,r.useEffect)(()=>{h()},[]);let h=async()=>{try{s(!0),c(null);let e=await p();a(e.products||[])}catch(e){c("商品データの読み込みに失敗しました"),console.error(e)}finally{s(!1)}},j=e=>{m(e),d(!0)},g=async e=>{if(confirm("この商品を削除してもよろしいですか？"))try{await x(e),await h()}catch(e){c("商品の削除に失敗しました"),console.error(e)}},N=()=>{d(!1),m(null)};return(0,t.jsxs)("div",{className:"container",children:[(0,t.jsxs)("div",{className:"header",children:[(0,t.jsx)("h1",{children:"商品管理システム"}),(0,t.jsx)("p",{children:"商品の追加、編集、削除ができます"})]}),l&&(0,t.jsxs)("div",{className:"error",children:[l,(0,t.jsx)("button",{onClick:()=>c(null),style:{float:"right",background:"none",border:"none",cursor:"pointer"},children:"\xd7"})]}),(0,t.jsx)("div",{className:"add-product-btn",children:(0,t.jsx)("button",{className:"btn btn-primary",onClick:()=>{m(null),d(!0)},children:"+ 新しい商品を追加"})}),n?(0,t.jsx)("div",{className:"loading",children:"読み込み中..."}):(0,t.jsx)("div",{className:"products-grid",children:e.map(e=>(0,t.jsx)(i,{product:e,onEdit:j,onDelete:g},e.id))}),o&&(0,t.jsx)(v,{product:u,onClose:N,onSave:()=>{h(),N()}})]})}}},function(e){e.O(0,[464,971,117,744],function(){return e(e.s=7450)}),_N_E=e.O()}]);